# Kubernetes Secret

## Task 1

### Create a key

```shell
$ hkubectl create secret generic test-secret --from-literal=username='a1kuat' --from-literal=password='aza'
secret/test-secret created
```

### Verify and describe the key

```shell
$  kubectl get secret
NAME          TYPE     DATA   AGE
test-secret   Opaque   2      72s
```

```shell
$  kubectl describe secret test-secret
Name:         test-secret
Namespace:    default
Labels:       <none>
Annotations:  <none>

Type:  Opaque

Data
====
password:  3 bytes
username:  6 bytes
```

### Decoding the key

```shell
$  kubectl get secret test-secret -o jsonpath='{.data}'
{"password":"YXph","username":"YTFrdWF0"}
```

```shell
$  echo 'YTFrdWF0' | base64 --decode
a1kuat
```

```shell
$  echo 'YXph' | base64 --decode
aza
```
### Installing plugin via `helm plugin install https://github.com/jkroepke/helm-secrets`

### ```gpg --gen-key```

### ``` sops -p 71EBFC46090A0CF8632535968A1201191108EE7E secrets.yaml```

### ```helm secrets install my-python-app ./my-python-app/ -n default -f ./secrets.yaml```

### `Kubectl get po` output:

```shell
$  kubectl get po
NAME                             READY   STATUS      RESTARTS   AGE
my-python-app-55b96bd467-k4z89   1/1     Running     0          104s
postinstall-hook                 0/1     Completed   0          104s
preinstall-hook                  0/1     Completed   0          116s
```

### Verify

```shell
$  kubectl exec my-python-app-55b96bd467-k4z89 -- printenv | grep MY_PASSWORD
MY_PASSWORD=aza
```

## Task 2

## Adding hashicorp, updating and installing:

```shell
$  helm repo add hashicorp https://helm.releases.hashicorp.com
"hashicorp" has been added to your repositories
```

```shell
$  helm repo update
Hang tight while we grab the latest from your chart repositories...
...Successfully got an update from the "hashicorp" chart repository
...Successfully got an update from the "stable" chart repository
Update Complete. ⎈Happy Helming!⎈
```

```shell
$  helm repo update
Hang tight while we grab the latest from your chart repositories...
...Successfully got an update from the "hashicorp" chart repository
...Successfully got an update from the "stable" chart repository
Update Complete. ⎈Happy Helming!⎈
```

```shell
$  helm install vault hashicorp/vault --set "server.dev.enabled=true"
NAME: vault
LAST DEPLOYED: Wed Apr  17 01:05:09 2024
NAMESPACE: default
STATUS: deployed
REVISION: 1
NOTES:
Thank you for installing HashiCorp Vault!

Now that you have deployed Vault, you should look over the docs on using
Vault with Kubernetes available here:

https://developer.hashicorp.com/vault/docs


Your release is named vault. To learn more about the release, try:

  $ helm status vault
  $ helm get manifest vault
```

```shell
$  kubectl get pods
NAME                                   READY   STATUS      RESTARTS   AGE
my-python-app-55b96bd467-k4z89         1/1     Running     0          10m
postinstall-hook                       0/1     Completed   0          10m
preinstall-hook                        0/1     Completed   0          11m
vault-0                                1/1     Running     0          2m22s
vault-agent-injector-dbfc5cd77-hxgjx   1/1     Running     0          2m22s
```

